@page "/google-auth"
@using System.Net.Http.Headers;

@inject IJSRuntime jsRuntime

<button @onclick="StartGoogleAuth">Google認証</button>
<button @onclick="SignOut">ログアウト</button>

@code {
    private string accessToken;

    private async Task StartGoogleAuth()
    {
        try
        {
            // Google APIライブラリをロードする
            await jsRuntime.InvokeAsync<object>("loadGoogleApi");
            // Google OAuth2認証を開始する
            accessToken = await jsRuntime.InvokeAsync<string>("startGoogleAuth",
                "YOUR_CLIENT_ID_HERE", new string[] { "email", "profile" });

            // アクセストークンを使用して、Google APIにリクエストを送信する
            // 例:ユーザーのプロフィール情報を取得する
            HttpClient client = new HttpClient();
            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
            HttpResponseMessage response = await client.GetAsync("https://www.googleapis.com/oauth2/v2/userinfo");
            if (response.IsSuccessStatusCode)
            {
                string json = await response.Content.ReadAsStringAsync();
                Console.WriteLine(json);
            }
            else
            {
                Console.WriteLine("Failed to get user info");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

    private async Task SignOut()
    {
        try
        {
            // ユーザーをログアウトする
            await jsRuntime.InvokeAsync<object>("signOut");

            // アクセストークンをクリアする
            accessToken = null;
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}